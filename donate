<?php
include 'top.php';


    print '<p>Post Array:</p><pre>';
    print_r($_POST);
    print'</pre>';   


$thisURL = $domain . $phpSelf;

/* initialize variables */

$myFirstName = "";

$myLastName = "";

$myStreet = "";

$myCity = "";

$myState = "-";

$myPostalCode = "";

$myEmail = "";

$errorMsg = array();   

$dataRecord = array();    

$mailed = false; 

/* initialize error flags */

$firstNameERROR = false;

$lastNameERROR = false;

$streetERROR = false;

$cityERROR = false;

$stateERROR = false;

$postalCodeERROR = false;

$emailERROR = false;

if(isset($_POST["btnSubmit"])){
    
    /* if (!securityCheck($thisURL)) {
        $msg = '<p>Sorry you cannot access this page. ';
        $msg.= 'Security breach detected and reported.</p>';
        die($msg);
    } */
    
    $myFirstName = htmlentities($_POST["myFirstName"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myFirstName;
    
    $myLastName = htmlentities($_POST["myLastName"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myLastName;
    
    $myStreet = htmlentities($_POST["myStreet"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myStreet;
    
    $myCity = htmlentities($_POST["myCity"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myCity;
    
    $myState = htmlentities($_POST["myState"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myState;
    
    $myPostalCode = htmlentities($_POST["myPostalCode"], ENT_QUOTES, "UTF-8");
    $dataRecord[] = $myPostalCode;
    
    $email = filter_var($_POST["myEmail"], FILTER_SANITIZE_EMAIL);
    $dataRecord[] = $email;
    
    $ownNone = true;
    $ownOne = true;
    $ownMultiple = true;
    $famOwns = true;
    $closeFriendOwns = true;
    $gunTraining = true;
    $militaryMember = true;
    $experiencedGunViolence = true;
    $famExperienced = true;
    $closeFriendExperienced = true;
    
    /* validate!! */
    
    if($myFirstName == ""){
        $errorMsg[] = "Please enter your first name";
        $firstNameERROR = true;
    }elseif(!verifyAlphaNum($myFirstName)){
        $errorMsg[] = "Your first name appears to have extra characters";
        $firstNameERROR = true;
    }
    
    if($myLastName == ""){
        $errorMsg[] = "Please enter your first name";
        $lastNameERROR = true;
    }elseif(!verifyAlphaNum($myLastName)){
        $errorMsg[] = "Your last name appears to have extra characters";
    }
    
    if($email == ""){
        $errorMsg[] = "Please enter your email";
        $emailERROR = true;
    }elseif(!verifyEmail($email)){
        $errorMsg[] = "Your email appears to have extra characters";
        $emailERROR = true;
    }
    
    if($myStreet == ""){
        $errorMsg[] = "Please enter your street address";
        $streetERROR = true;
    }elseif(!verifyAlphaNum($myStreet)){
        $errorMsg[] = "Your street address appears to have extra characters";
        $streetERROR = true;
    }
    
    if($myCity == ""){
        $errorMsg[] = "Please enter your city";
        $cityERROR = true;
    }elseif(!verifyAlphaNum($myCity)){
        $errorMsg[] = "Your first name appears to have extra characters";
        $cityERROR = true;
    }
    
    if($myState == "-"){
        $errorMsg[] = "Please enter your state";
        $stateERROR = true;
    }
    
    if($myPostalCode == ""){
        $errorMsg[] = "Please enter your ZIP code";
        $postalCodeERROR = true;
    }elseif(!verifyAlphaNum($myPostalCode)){
        $errorMsg[] = "Your ZIP code appears to have extra characters";
        $postalCodeERROR = true;
    }
    
    if(isset($_POST[""]))
    
    if(!$errorMsg){
        if($debug){
            print PHP_EOL . '<p>Form is valid</p>';
        }
    }else{
        if($debug){
            print PHP_EOL . '<p>Form is invalid</p>';
        }
    }
    
    $myFolder = 'data/';
    
    $myFileName = 'donate';

    $fileExt = '.csv';
    
    $filename = $myFolder . $myFileName . $fileExt;
    
    if($debug){
        print PHP_EOL . '<p>filename is ' . $filename;
    }
    
    $file = fopen($filename, 'a');
    
    fputcsv($file, $dataRecord);
    
    $message = '<h2>Your information</h2>';
    
    foreach($_POST as $htmlName => $value) {
        
        $message .= '<p>';
        
        $camelCase = preg_split('/(?=[A-Z])/', substr($htmlName, 2));
        
        foreach($camelCase as $oneWord) {
            $message .= $oneWord . ' ';
        }    
            
            $message .= ' : ' . htmlentities($value, ENT_QUOTES, "UTF-8") . '</p>';
            
    }
    
    $to = $email;
    $cc = '';
    $bcc = 'echo.norcott@uvm.edu';
    
    $from = "AMEND THE SECOND <customer.service@amendthesecond.com>";
    
    $subject = "Your Info: ";
    
    $mailed = sendMail($to, $cc, $bcc, $from, $subject, $message);
    
}

?>

<article>
    <h1>Donate</h1>
    <p>All proceeds will go to the Vas Vegas Victim's Fund. The money you donate will help pay for the medical bills of the 
    victims of the awful Las Vegas Shooting that happened on October 1, 2017. View more information at 
    <a href="https://lasvegasvictimsfund.org/">lasvegasvictimsfund.org</a>. Thank you for your contribution</p>
    <figure>
        <img alt="bent gun barrel" class="roundedCornersSmall midSize" src="images/twistedgun.png" align="right"/>
    </figure>
    <form action="<?php print $phpSelf ?>"
          method="post"
          id="donate_form">
        
        <fieldset class="billingInfo">
            <legend>Billing Information</legend>
            
            <p>First Name:
                <input type="text" name="myFirstName" placeholder="First Name">
            </p>
            
            <p>Last Name:
                <input type="text" name="myLastName" placeholder="Last Name">
            </p>
            <p>Billing Address:</p>
            <p>Street:
                <input type="text" name="myStreet" placeholder="Street Address">
            </p>
            
            <p>City:
                <input type="text" name="myCity" placeholder="City">
            </p>
            <p>State:
                <select name="myState">
                    <option value="-"> - </option>
                    <option value="AL">AL</option>
                    <option value="AK">AK</option>
                    <option value="AZ">AZ</option>
                    <option value="AR">AR</option>
                    <option value="CA">CA</option>
                    <option value="CO">CO</option>
                    <option value="CT">CT</option>
                    <option value="DE">DE</option>
                    <option value="FL">FL</option>
                    <option value="GA">GA</option>
                    <option value="HI">HI</option>
                    <option value="ID">ID</option>
                    <option value="IL">IL</option>
                    <option value="IN">IN</option>
                    <option value="IA">IA</option>
                    <option value="KS">KS</option>
                    <option value="KY">KY</option>
                    <option value="LA">LA</option>
                    <option value="ME">ME</option>
                    <option value="MD">MD</option>
                    <option value="MA">MA</option>
                    <option value="MI">MI</option>
                    <option value="MN">MN</option>
                    <option value="MS">MS</option>
                    <option value="MO">MO</option>
                    <option value="MT">MT</option>
                    <option value="NE">NE</option>
                    <option value="NV">NV</option>
                    <option value="NH">NH</option>
                    <option value="NJ">NJ</option>
                    <option value="NM">NM</option>
                    <option value="NY">NY</option>
                    <option value="NC">NC</option>
                    <option value="ND">ND</option>
                    <option value="OH">OH</option>
                    <option value="OK">OK</option>
                    <option value="OR">OR</option>
                    <option value="PA">PA</option>
                    <option value="RI">RI</option>
                    <option value="SC">SC</option>
                    <option value="SD">SD</option>
                    <option value="TN">TN</option>
                    <option value="TX">TX</option>
                    <option value="UT">UT</option>
                    <option value="VT">VT</option>
                    <option value="VA">VA</option>
                    <option value="WA">WA</option>
                    <option value="WV">WV</option>
                    <option value="WI">WI</option>
                    <option value="WY">WY</option>
                </select>
            </p>
            <!-- drop box for state? -->
            
            <p>ZIP Code:
                <input type="text" name="myPostalCode" placeholder="ZIP Code">
            </p>
            
            <p>Email:
                <input type="text" name="myEmail" placeholder="youremail@website.com">
            </p>
            
        </fieldset>
        <!--Checkboxes--!>
        <fieldset id='quickInfo'>
            <legend>A Quick Survey</legend>
            <p>Please select the following that apply to your experience:</p>
            <br />
            <input type="checkbox" name="ownNone" value="Do not own a gun" checked="checked" />Do not own a gun <br />
            <input type="checkbox" name="ownOne" value="Own one gun" />Own one gun <br />
            <input type="checkbox" name="ownMultiple" value="Own multiple guns" /> Own multiple guns <br />
            <input type="checkbox" name="famOwns" value="Family member owns a gun" /> Family member owns a gun <br />
            <input type="checkbox" name="closeFriendOwns" value="Close friend owns a gun" /> Close friend owns a gun <br />
            <input type="checkbox" name="gunTraining" value="Have had training with guns" /> Have had training with guns <br />
            <input type="checkbox" name="militaryMember" value="Am/Was a member of the military" /> Am/Was a member of the military <br />
            <input type="checkbox" name="experiencedGunViolence" value="Have expierienced gun violence" /> Have experienced gun violence <br />
            <input type="checkbox" name="famExperienced" value="Family member has experienced gun violence" /> Family member has experienced gun violence <br />
            <input type="checkbox" name="closeFriendExperienced" value="Close friend has experienced gun violence" /> Close friend has experienced gun violence <br />
        </fieldset>
        
        <fieldset id="paymentInfo">
            <legend>Payment Information</legend>
            
            <p>Amount:
                <input type="radio" name="myAmount" value="25.00" >$25.00
                <input type="radio" name="myAmount" value="50.00" >$50.00
                <input type="radio" name="myAmount" value="100.00" >$100.00
                <input type="radio" name="myAmount" value="500.00" >$500.00
                <input type="radio" name="myAmount" value="1000.00" >$1,000.00
                <input type="radio" name="myAmount" value="" >
                    <input type="text" placeholder="$XXX.XX">
            </p>
            
            <p>Card Number:
                <input type="text" name="myCardNum" maxlength="4" placeholder="XXXX-XXXX-XXXX-XXXX">
            </p>
            
            <p>Expiration Date:
                <select name="myMonth">
                    <option value="01">01</option>
                    <option value="02">02</option>
                    <option value="03">03</option>
                    <option value="04">04</option>
                    <option value="05">05</option>
                    <option value="06">06</option>
                    <option value="07">07</option>
                    <option value="08">08</option>
                    <option value="09">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
                <select name="myYear">
                    <option value="2017">2017</option>
                    <option value="2018">2018</option>
                    <option value="2019">2019</option>
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </p>
            
            <p>CVV Number:
                <input type="text" name="myCvvNum" maxlength="1" placeholder="XXX">
            </p>
    
    </form>
    
</article>

<?php
include 'footer.php';
?>

